name: WebAI Daily Content Machine

# ------------------------------------------------------------------
# 1. Ø§Ù„ØªÙˆÙ‚ÙŠØª (ÙŠØªÙ… Ø§Ù„ØªØ´ØºÙŠÙ„ ÙŠÙˆÙ…ÙŠØ§Ù‹ ÙˆØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
# ------------------------------------------------------------------
on:
  schedule:
    # Ø³ÙŠØªÙ… Ø§Ù„ØªØ´ØºÙŠÙ„ ÙƒÙ„ ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¹Ø© 9:00 ØµØ¨Ø§Ø­Ø§Ù‹ Ø¨ØªÙˆÙ‚ÙŠØª UTC
    - cron: '0 9 * * *'
  workflow_dispatch: # ÙŠØ³Ù…Ø­ Ù„Ùƒ Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¯ÙˆÙŠØ§Ù‹ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª Ø¨Ø¶ØºØ·Ø© Ø²Ø±

# ------------------------------------------------------------------
# 2. Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Ø¶Ø±ÙˆØ±ÙŠØ© Ù„Ø­ÙØ¸ Ù…Ù„ÙØ§Øª Ø§Ù„Ù€ JSON ÙˆØ§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø­Ø¯Ø«Ø©)
# ------------------------------------------------------------------
permissions:
  contents: write

jobs:
  build-and-run:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Ø³Ø­Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
      - name: ğŸ“‚ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Ù„Ø³Ø­Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø±ÙØ¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª

      # 2. Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨Ø§ÙŠØ«ÙˆÙ† (Ù†Ø³Ø®Ø© 3.11 Ù…Ø³ØªÙ‚Ø±Ø©)
      - name: ğŸ Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip' # ØªØ³Ø±ÙŠØ¹ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙÙŠ Ø§Ù„Ù…Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©

      # 3. ØªØ«Ø¨ÙŠØª Ù…ØªØµÙØ­ Google Chrome (Ø¶Ø±ÙˆØ±ÙŠ Ø¬Ø¯Ø§Ù‹ Ù„Ø¹Ù…Ù„ Selenium Ùˆ url_resolver)
      - name: ğŸŒ Install Google Chrome
        run: |
          wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
          sudo sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google-chrome.list'
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable

      # 4. ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
      - name: ğŸ“¦ Install Dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          # ØªØ«Ø¨ÙŠØª Ù…ÙƒØªØ¨Ø© OpenAI Ø®ØµÙŠØµØ§Ù‹ Ù„Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
          pip install openai 

      # 5. ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (WebAI Engine)
      # Ù‡Ù†Ø§ ÙŠØªÙ… ØªÙ…Ø±ÙŠØ± ÙƒØ§ÙØ© Ø§Ù„Ù€ Secrets ÙƒÙ…ØªØºÙŠØ±Ø§Øª Ø¨ÙŠØ¦Ø© Ù„ÙŠÙ‚Ø±Ø£Ù‡Ø§ Ø§Ù„ÙƒÙˆØ¯
      - name: ğŸš€ Run WebAI Article Generator
        env:
          # Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯
          WEBAI_BASE_URL: ${{ secrets.WEBAI_BASE_URL }}
          
          # Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø¨Ø­Ø«
          GNEWS_API_KEY: ${{ secrets.GNEWS_API_KEY }}
          
          # Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù†Ø´Ø± (Blogger)
          BLOGGER_CLIENT_ID: ${{ secrets.BLOGGER_CLIENT_ID }}
          BLOGGER_CLIENT_SECRET: ${{ secrets.BLOGGER_CLIENT_SECRET }}
          BLOGGER_REFRESH_TOKEN: ${{ secrets.BLOGGER_REFRESH_TOKEN }}
          BLOGGER_BLOG_ID: ${{ secrets.BLOGGER_BLOG_ID }}
          
          # Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (YouTube)
          YOUTUBE_CREDENTIALS_JSON: ${{ secrets.YOUTUBE_CREDENTIALS_JSON }}
          
          # Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ (Facebook)
          FB_APP_ID: ${{ secrets.FB_APP_ID }}
          FB_APP_SECRET: ${{ secrets.FB_APP_SECRET }}
          FB_PAGE_ID: ${{ secrets.FB_PAGE_ID }}
          FB_PAGE_ACCESS_TOKEN: ${{ secrets.FB_PAGE_ACCESS_TOKEN }}
          
          # Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ®Ø²ÙŠÙ† (GitHub CDN)
          MY_GITHUB_TOKEN: ${{ secrets.MY_GITHUB_TOKEN }}
          GITHUB_REPO_NAME: ${{ github.repository }}
          
          # Ø§Ø­ØªÙŠØ§Ø·ÙŠ (Gemini)
          GEMINI_API_KEY_1: ${{ secrets.GEMINI_API_KEY_1 }}
        run: |
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ù„Ù„Ù…Ø®Ø±Ø¬Ø§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ© (Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØ§Ù„ØµÙˆØ±)
          mkdir -p output
          mkdir -p assets
          # ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø±Ùƒ
          python article_generator_webai.py

      # 6. ØªØ­Ø¯ÙŠØ« ØªÙˆÙ‚ÙŠØª Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¯Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ø¬Ø¹Ù„ Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹)
      - name: ğŸ² Randomize Next Schedule
        run: python update_schedule.py

      # 7. Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ù€ Knowledge Graph (Ù„Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª)
      - name: ğŸ’¾ Commit and Push Changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø© ÙÙ‚Ø·
          git add knowledge_graph.json
          git add .github/workflows/*.yml || true
          
          # Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ØªØºÙŠÙŠØ±Ø§Øª ÙØ¹Ù„Ø§Ù‹ Ù„ØªØ¬Ù†Ø¨ Ø®Ø·Ø£ Commit ÙØ§Ø±Øº
          if git diff --quiet && git diff --staged --quiet; then
            echo "No changes to commit."
          else
            git commit -m "ğŸ¤– Auto-update: Knowledge Graph & Schedule [skip ci]"
            git push origin main
          fi

      # 8. Ø±ÙØ¹ Ù…Ø®Ø±Ø¬Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙƒÙ€ Artifacts (Ù„ØªØ­Ù…ÙŠÙ„Ù‡Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª)
      - name: ğŸ“‚ Upload Production Artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: production-output
          path: |
            output/
            *.html
          retention-days: 5
